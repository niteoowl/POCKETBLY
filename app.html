<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA 설치하기</title>
    <!-- Tailwind CSS 로드 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* 커스텀 스타일 (폰트 및 배경) */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d1117; /* GitHub Dark Theme 배경 */
        }
        .container-card {
            background-color: #161b22; /* 카드 배경 */
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.5), 0 6px 6px -3px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div class="container-card max-w-lg w-full p-8 rounded-xl space-y-6 text-center">
        <!-- 제목 및 설명 -->
        <h1 class="text-3xl font-bold text-white mb-2">
            앱을 설치하세요!
        </h1>
        <p class="text-gray-400 mb-6">
            이 웹사이트를 모바일이나 데스크톱에 앱처럼 설치하고 더 빠르게 이용해보세요.
        </p>

        <!-- 설치 버튼 -->
        <button id="installButton"
            class="hidden w-full py-3 px-6 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg transition duration-200 transform hover:scale-105 active:scale-100 focus:outline-none focus:ring-4 focus:ring-blue-500 focus:ring-opacity-50 disabled:bg-gray-600 disabled:cursor-not-allowed"
            aria-label="앱 설치 버튼">
            <span id="buttonText">앱 설치하기</span>
        </button>

        <!-- 메시지 영역 -->
        <div id="message" class="text-sm text-gray-500 mt-4">
            설치 기능 지원 여부를 확인 중입니다...
        </div>

        <!-- PWA 아이콘 자리 (예시) -->
        <div class="mt-8">
            <svg class="mx-auto h-12 w-12 text-blue-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
        </div>
    </div>

    <script>
        // 전역 변수 설정
        let deferredPrompt; // PWA 설치 프롬프트 이벤트를 저장할 변수
        const installButton = document.getElementById('installButton');
        const messageElement = document.getElementById('message');
        const buttonText = document.getElementById('buttonText');

        /**
         * PWA 설치 버튼 상태를 업데이트하는 함수
         * @param {string} state - 'hidden', 'visible', 'installed' 중 하나
         * @param {string} msg - 사용자에게 표시할 메시지
         */
        function updateUI(state, msg) {
            messageElement.textContent = msg;

            if (state === 'visible') {
                installButton.classList.remove('hidden');
                installButton.disabled = false;
                buttonText.textContent = '앱 설치하기';
            } else if (state === 'installed') {
                installButton.classList.add('hidden');
            } else if (state === 'hidden') {
                installButton.classList.add('hidden');
            }
        }

        // 1. 'beforeinstallprompt' 이벤트 리스너: 설치 프롬프트 이벤트를 가로채어 저장합니다.
        window.addEventListener('beforeinstallprompt', (e) => {
            // 브라우저의 기본 프롬프트 노출을 막습니다.
            e.preventDefault();
            // 이벤트 객체를 저장하여 나중에 수동으로 호출할 수 있게 합니다.
            deferredPrompt = e;

            // 사용자 지정 설치 버튼을 보여줍니다.
            updateUI('visible', '설치 버튼이 활성화되었습니다. 클릭하여 설치하세요.');
        });

        // 2. 설치 버튼 클릭 이벤트 핸들러
        installButton.addEventListener('click', async () => {
            if (deferredPrompt) {
                // 버튼을 비활성화하여 중복 클릭을 막습니다.
                installButton.disabled = true;
                buttonText.textContent = '설치 요청 중...';
                
                // 저장해 둔 프롬프트 이벤트의 prompt() 메서드를 호출합니다.
                deferredPrompt.prompt();

                // 사용자의 선택 결과를 기다립니다.
                const { outcome } = await deferredPrompt.userChoice;
                
                // 사용자 선택에 따른 피드백을 제공합니다.
                if (outcome === 'accepted') {
                    updateUI('installed', '성공적으로 설치되었습니다! 🎉');
                } else {
                    updateUI('installed', '설치가 취소되었습니다. 원할 때 다시 시도할 수 있습니다.');
                }

                // 프롬프트는 한 번만 사용할 수 있으므로 null로 초기화합니다.
                deferredPrompt = null;

            } else {
                updateUI('hidden', '이 브라우저는 PWA 설치를 지원하지 않거나 이미 설치되었습니다. (beforeinstallprompt 이벤트가 발생하지 않았습니다)');
            }
        });

        // 3. 앱 설치 상태 확인 (선택 사항)
        if (window.matchMedia('(display-mode: standalone)').matches || document.referrer.includes('?utm_source=pwa')) {
            updateUI('installed', '이 앱은 이미 설치된 상태입니다.');
        } else if (!('BeforeInstallPromptEvent' in window)) {
            // beforeinstallprompt 이벤트 자체가 없는 경우 (대부분의 데스크톱 브라우저에서는 이 이벤트가 발생하지 않음)
            updateUI('hidden', '이 브라우저는 PWA 설치 기능을 지원하지 않습니다.');
        } else {
            // beforeinstallprompt 이벤트를 기다리는 중
            updateUI('hidden', 'PWA 설치 지원 여부를 확인 중입니다...');
        }

        // 4. 앱이 설치된 후 'appinstalled' 이벤트 처리 (선택 사항)
        window.addEventListener('appinstalled', () => {
            // 설치 후 UI를 업데이트합니다.
            updateUI('installed', '앱 설치가 완료되었습니다. 감사합니다!');
            // deferredPrompt를 null로 재설정합니다.
            deferredPrompt = null;
        });

    </script>
</body>
</html>
