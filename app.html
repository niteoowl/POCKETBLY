<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA 설치 페이지</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter 폰트 설정 -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f9;
        }
    </style>

    <!-- PWA 관련 메타 태그 (실제 PWA 기능을 위해 manifest.json과 Service Worker가 필요합니다) -->
    <!-- 여기서는 UI만 제공하지만, 실제 PWA는 이 메타 태그와 함께 작동합니다. -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="MyPWAApp">
    <link rel="apple-touch-icon" href="https://placehold.co/180x180/000000/FFFFFF?text=PWA">
    
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- 메인 컨테이너 -->
    <div class="w-full max-w-md bg-white p-8 rounded-xl shadow-2xl border border-gray-100 transform transition-all duration-300 hover:shadow-3xl">
        <div class="text-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-16 h-16 mx-auto text-indigo-600 mb-4" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                <path d="M6.5 2H20v20h-7.5"></path>
                <path d="m2 15 2 2 2-2"></path>
                <path d="m2 11 2 2 2-2"></path>
            </svg>
            <h1 class="text-3xl font-extrabold text-gray-900 mb-2">프로그레시브 웹 앱</h1>
            <p class="text-lg text-gray-500 mb-6">
                이 앱을 설치하여 더 빠르고 오프라인에서도 사용할 수 있는 경험을 즐기세요.
            </p>
        </div>

        <!-- 설치 버튼 (초기에 숨겨져 있음) -->
        <button id="installButton"
                class="w-full flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-lg shadow-lg text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200 transform scale-100 hover:scale-[1.02] active:scale-95 disabled:opacity-50"
                style="display: none;">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            앱 설치
        </button>

        <!-- 정보 메시지 -->
        <div id="infoMessage" class="mt-4 p-4 bg-indigo-50 text-indigo-700 rounded-lg text-sm text-center">
            브라우저가 PWA 설치를 지원할 때 설치 버튼이 자동으로 나타납니다.
        </div>
        
        <!-- 설치 완료 메시지 (PWA로 실행 중일 때) -->
        <div id="installedMessage" class="mt-4 p-4 bg-green-50 text-green-700 rounded-lg text-sm text-center font-semibold" style="display: none;">
            앱이 이미 설치되어 있습니다! 홈 화면에서 실행해 보세요.
        </div>

    </div>

    <script>
        // PWA 설치 프롬프트를 저장할 변수
        let deferredPrompt;
        const installButton = document.getElementById('installButton');
        const infoMessage = document.getElementById('infoMessage');
        const installedMessage = document.getElementById('installedMessage');
        
        // ************************************************************
        // 1. PWA 설치 가능 여부 확인 (beforeinstallprompt 이벤트)
        // ************************************************************

        window.addEventListener('beforeinstallprompt', (e) => {
            // 브라우저의 기본 설치 프롬프트 표시를 막습니다.
            e.preventDefault();
            // 이벤트 객체를 저장합니다. 사용자가 버튼을 클릭하면 나중에 이 객체를 사용합니다.
            deferredPrompt = e;
            
            // 버튼을 보여주고 안내 메시지를 숨깁니다.
            installButton.style.display = 'flex';
            infoMessage.style.display = 'none';

            console.log('beforeinstallprompt event fired. Install button is now visible.');
        });

        // ************************************************************
        // 2. 설치 버튼 클릭 이벤트 핸들러
        // ************************************************************
        
        installButton.addEventListener('click', async () => {
            // 버튼을 비활성화하고 로딩 상태를 표시할 수 있습니다.
            installButton.disabled = true;
            installButton.textContent = '설치 요청 중...';

            if (deferredPrompt) {
                // 저장된 프롬프트를 실행합니다.
                deferredPrompt.prompt();
                
                // 사용자가 프롬프트에 응답할 때까지 기다립니다.
                const { outcome } = await deferredPrompt.userChoice;

                console.log(`User response to the install prompt: ${outcome}`);

                // 프롬프트는 한 번만 사용할 수 있으므로 null로 재설정합니다.
                deferredPrompt = null;
                
                if (outcome === 'accepted') {
                    // 설치가 수락됨. 버튼을 숨기고 완료 메시지를 표시합니다.
                    console.log('PWA installation accepted.');
                    installButton.style.display = 'none';
                    installedMessage.style.display = 'block';
                } else {
                    // 설치가 거부됨. 버튼을 다시 활성화하고 메시지를 업데이트합니다.
                    console.log('PWA installation dismissed.');
                    installButton.disabled = false;
                    installButton.textContent = '앱 설치'; // 버튼 텍스트를 원래대로 복원
                }
            } else {
                // deferredPrompt가 없으면 설치 불가능 상태이거나 이미 설치가 시도되었음을 의미합니다.
                console.warn('Install prompt not available.');
                // 사용자에게 브라우저 설정에서 설치를 시도해 보라고 안내할 수 있습니다.
                installButton.textContent = '설치 불가 (수동 시도)';
            }
        });
        
        // ************************************************************
        // 3. 앱이 PWA 모드로 실행 중인지 확인
        // ************************************************************

        // 앱이 독립형 모드(standalone, PWA 모드)로 실행 중인지 확인합니다.
        function checkStandaloneMode() {
            const isStandalone = (window.matchMedia('(display-mode: standalone)').matches) || 
                                 (navigator.standalone); // iOS용
            
            if (isStandalone) {
                // 이미 PWA로 실행 중이면 설치 버튼과 정보 메시지를 숨기고 설치 완료 메시지를 표시합니다.
                installButton.style.display = 'none';
                infoMessage.style.display = 'none';
                installedMessage.style.display = 'block';
                console.log('App is running in standalone (PWA) mode.');
            }
        }

        // 페이지 로드 시 확인
        checkStandaloneMode();

        // PWA가 설치된 후 실행 모드가 변경될 때를 대비해 이벤트 리스너를 추가할 수 있습니다.
        window.addEventListener('appinstalled', () => {
            console.log('PWA was successfully installed.');
            // 설치 후에는 프롬프트가 더 이상 필요 없으므로 숨깁니다.
            installButton.style.display = 'none';
            installedMessage.style.display = 'block';
        });

    </script>
</body>
</html>
